# Story 3.1: Chatbot UI Foundation

**Epic:** Epic 3 - Custom AI Chatbots
**Status:** Not Started
**Estimated Effort:** 8-12 hours
**Priority:** High (Foundational)

---

## User Story

**As a user**, I want to see and interact with a chat interface, so that I can engage with my AI chatbots in a familiar conversational format.

---

## Story Goal

Create the complete visual interface for chatbot interaction, including a Floating Action Button (FAB) to trigger the chat, an expandable chat window, and all necessary UI components for displaying and sending messages. This story establishes the foundation for the chatbot experience without connecting to any backend AI services.

---

## Acceptance Criteria

### UI Components
- [ ] FAB appears in the bottom-right corner of the main editor view
- [ ] FAB has appropriate icon (chat bubble or bot icon)
- [ ] FAB has hover state with tooltip "Open Chat"
- [ ] FAB pulses subtly to indicate interactivity (optional animation)

### Chat Window
- [ ] Clicking FAB opens chat window with smooth slide-up animation
- [ ] Chat window appears as overlay with proper z-index
- [ ] Chat window has header with:
  - Chatbot name (placeholder: "My Assistant")
  - Minimize button
  - Close button
- [ ] Chat window has message area with scroll functionality
- [ ] Chat window has footer with input field and send button

### Message Display
- [ ] User messages display on right side with distinct styling
- [ ] Assistant messages display on left side with distinct styling
- [ ] Messages show timestamps
- [ ] Messages support markdown rendering
- [ ] Long messages scroll within their bubble
- [ ] Message list auto-scrolls to newest message

### Message Input
- [ ] Input field expands vertically for multi-line text
- [ ] Input field has placeholder text: "Type a message..."
- [ ] Send button is disabled when input is empty
- [ ] Pressing Enter sends message (Shift+Enter for new line)
- [ ] After sending, input field clears and refocuses

### Interactions
- [ ] User can type and send messages
- [ ] Sent messages appear immediately in chat
- [ ] Assistant responds with placeholder message (e.g., "This is a placeholder response. AI connection coming soon!")
- [ ] Placeholder response appears after 1 second delay to simulate thinking
- [ ] Chat window can be minimized (collapses to FAB)
- [ ] Chat window can be closed (hides completely)
- [ ] Chat state persists when minimized (messages remain)
- [ ] Opening a new chat session shows welcome message

### Responsive Design
- [ ] Chat window scales appropriately on different screen sizes
- [ ] On mobile/tablet, chat window can be full screen
- [ ] FAB position adjusts for mobile viewports
- [ ] Touch interactions work smoothly

### Accessibility
- [ ] FAB has proper aria-label
- [ ] Chat window is keyboard navigable
- [ ] Focus management when opening/closing chat
- [ ] Screen reader announces new messages
- [ ] Proper heading hierarchy in chat header

---

## Dev Notes

### Component Architecture

```
components/chat/
├── FloatingChatButton.tsx    # FAB component
├── ChatWindow.tsx            # Main chat container
├── ChatHeader.tsx            # Header with title and controls
├── ChatMessageList.tsx       # Scrollable message container
├── ChatBubble.tsx            # Individual message display
├── ChatInput.tsx             # Input field and send button
└── ChatWelcome.tsx           # Welcome message component
```

### State Management

Use Zustand for chat state:

```typescript
// store/chatStore.ts
interface ChatStore {
  isOpen: boolean;
  isMinimized: boolean;
  messages: Message[];
  openChat: () => void;
  closeChat: () => void;
  minimizeChat: () => void;
  addMessage: (message: Message) => void;
  clearMessages: () => void;
}

interface Message {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: Date;
}
```

### Styling Requirements

Per CLAUDE.md, all styling must use CSS variables:

```css
/* Add to app/globals.css */
:root {
  /* Chat specific colors */
  --chat-user-bg: var(--accent);
  --chat-user-text: var(--background);
  --chat-assistant-bg: var(--muted);
  --chat-assistant-text: var(--foreground);
  --chat-window-bg: var(--background);
  --chat-header-bg: var(--foreground);
  --chat-header-text: var(--background);

  /* Chat dimensions */
  --chat-window-width: 380px;
  --chat-window-height: 600px;
  --chat-window-mobile-height: 100vh;
  --fab-size: 60px;
  --fab-offset: 24px;
}
```

### Animation Guidelines

```typescript
// Use Framer Motion for animations
import { motion, AnimatePresence } from 'framer-motion';

const chatWindowVariants = {
  hidden: {
    opacity: 0,
    y: 100,
    scale: 0.9
  },
  visible: {
    opacity: 1,
    y: 0,
    scale: 1,
    transition: { type: 'spring', duration: 0.3 }
  },
  exit: {
    opacity: 0,
    y: 100,
    scale: 0.9,
    transition: { duration: 0.2 }
  }
};
```

---

## Technical Details

### File Structure

```typescript
// components/chat/FloatingChatButton.tsx
'use client';

import { MessageSquare } from 'lucide-react';
import { useChatStore } from '@/store/chatStore';
import { cn } from '@/lib/utils';

export function FloatingChatButton() {
  const { isOpen, openChat } = useChatStore();

  if (isOpen) return null; // Hide when chat is open

  return (
    <button
      onClick={openChat}
      className={cn(
        "fixed bottom-[var(--fab-offset)] right-[var(--fab-offset)]",
        "w-[var(--fab-size)] h-[var(--fab-size)]",
        "bg-[var(--accent)] text-[var(--background)]",
        "rounded-full shadow-lg",
        "flex items-center justify-center",
        "hover:scale-110 transition-transform",
        "focus:outline-none focus:ring-2 focus:ring-[var(--accent)]"
      )}
      aria-label="Open chat"
    >
      <MessageSquare size={24} />
    </button>
  );
}
```

```typescript
// components/chat/ChatWindow.tsx
'use client';

import { AnimatePresence, motion } from 'framer-motion';
import { useChatStore } from '@/store/chatStore';
import { ChatHeader } from './ChatHeader';
import { ChatMessageList } from './ChatMessageList';
import { ChatInput } from './ChatInput';
import { cn } from '@/lib/utils';

export function ChatWindow() {
  const { isOpen, isMinimized } = useChatStore();

  if (!isOpen) return null;

  return (
    <AnimatePresence>
      {!isMinimized && (
        <motion.div
          initial="hidden"
          animate="visible"
          exit="exit"
          variants={chatWindowVariants}
          className={cn(
            "fixed bottom-[var(--fab-offset)] right-[var(--fab-offset)]",
            "w-[var(--chat-window-width)] h-[var(--chat-window-height)]",
            "bg-[var(--chat-window-bg)]",
            "border border-[var(--border)]",
            "rounded-lg shadow-2xl",
            "flex flex-col",
            "overflow-hidden",
            "md:w-[var(--chat-window-width)]",
            "max-md:w-full max-md:h-[var(--chat-window-mobile-height)]",
            "max-md:bottom-0 max-md:right-0 max-md:rounded-none"
          )}
        >
          <ChatHeader />
          <ChatMessageList />
          <ChatInput />
        </motion.div>
      )}
    </AnimatePresence>
  );
}

const chatWindowVariants = {
  hidden: { opacity: 0, y: 100, scale: 0.9 },
  visible: { opacity: 1, y: 0, scale: 1 },
  exit: { opacity: 0, y: 100, scale: 0.9 }
};
```

```typescript
// store/chatStore.ts
import { create } from 'zustand';
import { v4 as uuidv4 } from 'uuid';

interface Message {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: Date;
}

interface ChatStore {
  isOpen: boolean;
  isMinimized: boolean;
  messages: Message[];
  openChat: () => void;
  closeChat: () => void;
  minimizeChat: () => void;
  addMessage: (content: string, role: 'user' | 'assistant') => void;
  clearMessages: () => void;
}

export const useChatStore = create<ChatStore>((set) => ({
  isOpen: false,
  isMinimized: false,
  messages: [],

  openChat: () => set({ isOpen: true, isMinimized: false }),
  closeChat: () => set({ isOpen: false }),
  minimizeChat: () => set({ isMinimized: true }),

  addMessage: (content, role) => set((state) => ({
    messages: [
      ...state.messages,
      {
        id: uuidv4(),
        role,
        content,
        timestamp: new Date(),
      },
    ],
  })),

  clearMessages: () => set({ messages: [] }),
}));
```

---

## Tasks

1. **Setup Chat Store** (1 hour)
   - [ ] Create `store/chatStore.ts` with Zustand
   - [ ] Define Message and ChatStore interfaces
   - [ ] Implement state management functions

2. **Create FAB Component** (1 hour)
   - [ ] Create `components/chat/FloatingChatButton.tsx`
   - [ ] Add icon and styling
   - [ ] Connect to chat store
   - [ ] Add hover and focus states

3. **Create Chat Window Shell** (2 hours)
   - [ ] Create `components/chat/ChatWindow.tsx`
   - [ ] Add Framer Motion animations
   - [ ] Implement responsive design
   - [ ] Add CSS variables to globals.css

4. **Create Chat Header** (1 hour)
   - [ ] Create `components/chat/ChatHeader.tsx`
   - [ ] Add title, minimize, and close buttons
   - [ ] Connect controls to store actions

5. **Create Message List** (2 hours)
   - [ ] Create `components/chat/ChatMessageList.tsx`
   - [ ] Implement auto-scroll behavior
   - [ ] Add loading indicator for assistant response

6. **Create Message Bubble** (2 hours)
   - [ ] Create `components/chat/ChatBubble.tsx`
   - [ ] Style user vs assistant messages differently
   - [ ] Add markdown rendering support
   - [ ] Add timestamp display

7. **Create Chat Input** (2 hours)
   - [ ] Create `components/chat/ChatInput.tsx`
   - [ ] Implement auto-expanding textarea
   - [ ] Add send button with disabled state
   - [ ] Handle Enter and Shift+Enter

8. **Add Placeholder Logic** (1 hour)
   - [ ] Simulate assistant response delay
   - [ ] Add welcome message on first open
   - [ ] Add placeholder response messages

9. **Testing & Polish** (2 hours)
   - [ ] Test all interactions
   - [ ] Test responsive behavior
   - [ ] Test keyboard navigation
   - [ ] Add unit tests for chat store

---

## Testing Checklist

### Manual Testing
- [ ] Open/close chat from FAB
- [ ] Send multiple messages
- [ ] Verify placeholder responses appear
- [ ] Test minimize/restore functionality
- [ ] Test on desktop, tablet, and mobile
- [ ] Test keyboard navigation
- [ ] Test with screen reader

### Unit Tests
```typescript
// __tests__/chatStore.test.ts
describe('useChatStore', () => {
  it('should open chat', () => { /* ... */ });
  it('should close chat', () => { /* ... */ });
  it('should add message', () => { /* ... */ });
  it('should minimize chat', () => { /* ... */ });
});
```

---

## Dependencies

### New Packages
```bash
npm install framer-motion uuid
npm install --save-dev @types/uuid
```

### Existing Dependencies
- Zustand (already in Epic 2)
- Lucide React icons
- Tailwind CSS

---

## Definition of Done

- [ ] All acceptance criteria met
- [ ] Code follows CLAUDE.md standards
- [ ] All components under 250 lines
- [ ] CSS variables used for all styling
- [ ] TypeScript types properly defined
- [ ] Unit tests written and passing
- [ ] Manual testing completed
- [ ] Responsive design verified
- [ ] Accessibility validated
- [ ] Code reviewed and approved
- [ ] Deployed to development environment

---

## Screenshots / Mockups

*(To be added during implementation)*

### Desktop View
- FAB in bottom-right corner
- Chat window expanded
- User and assistant messages

### Mobile View
- Full-screen chat experience
- Proper touch interactions

---

## Notes

- This story contains NO backend integration
- All messages are stored in local state only
- Placeholder responses simulate real AI behavior
- Foundation for Stories 3.2-3.4 which add real AI

---

**Next Story:** 3.2 - Chatbot Creation & Configuration
